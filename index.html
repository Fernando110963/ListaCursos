<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cursos+ — Login, Dashboard e Meus Cursos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-0:#071024;
      --bg-1:#0b1220;
      --glass: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.06);
      --text:#e6eef8;
      --sub:#9fb3d1;
      --primary:#5eead4;
      --accent:#a78bfa;
      --ok:#34d399;
      --warn:#f59e0b;
      --danger:#fb7185;
      --radius:14px;
      --card-shadow: 0 10px 30px rgba(2,6,23,0.6);
      --glass-border: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--text);background:
      radial-gradient(800px 400px at 10% 10%, rgba(167,139,250,0.06), transparent 20%),
      radial-gradient(800px 400px at 90% 90%, rgba(34,211,238,0.04), transparent 20%),
      linear-gradient(180deg,var(--bg-0),var(--bg-1));}
    a{color:var(--primary);text-decoration:none}

    .wrap{max-width:1100px;margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr;gap:18px;}
    .card{background:linear-gradient(180deg,var(--glass),var(--glass-2));border:1px solid var(--glass-border);border-radius:var(--radius);box-shadow:var(--card-shadow);overflow:hidden}
    .header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid var(--glass-border)}
    .brand{font-weight:800;letter-spacing:.4px;font-size:18px;display:flex;gap:10px;align-items:center}
    .brand .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:grid;place-items:center;color:#061221;font-weight:800}
    .nav{display:flex;gap:10px;align-items:center}
    .nav button{background:transparent;border:1px solid transparent;color:var(--sub);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .nav button.active{background:rgba(255,255,255,0.04);border-color:var(--glass-border);color:var(--text)}
    .nav .logout{background:var(--warn);color:#0b1220;border:none}

    .panel{padding:22px;display:grid;gap:14px}

    .auth-wrap{display:flex;flex-direction:row;gap:30px;align-items:center;justify-content:center;padding:18px}
    .auth-box{width:100%;max-width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02),rgba(255,255,255,0.015));border-radius:12px;padding:22px;border:1px solid rgba(255,255,255,0.03)}
    .auth-title{font-size:20px;font-weight:700;margin-bottom:6px}
    .muted{color:var(--sub);font-size:13px;margin-bottom:10px}
    .field{display:grid;gap:8px;margin-bottom:10px}
    input[type="email"],input[type="password"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
    .btn{border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#061221}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)}
    .small{font-size:13px;color:var(--sub)}
    .error{color:var(--danger);font-weight:700}

    .toolbar{display:flex;gap:12px;align-items:center}
    .toolbar input[type="text"],.toolbar select{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .list{display:grid;gap:10px}
    .course-card{display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .course-left{display:flex;gap:12px;align-items:center;min-width:0}
    .thumb{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--primary));display:grid;place-items:center;font-weight:800;color:#061221}
    .course-meta h4{margin:0;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:420px}
    .course-meta small{color:var(--sub)}
    .course-actions{display:flex;gap:8px;align-items:center}
    .pill{padding:6px 10px;border-radius:999px;font-weight:700;border:1px solid rgba(255,255,255,0.03)}
    .pill.todo{background:rgba(167,139,250,0.12);color:var(--accent)}
    .pill.doing{background:rgba(34,211,238,0.12);color:var(--primary)}
    .pill.done{background:rgba(52,211,153,0.12);color:var(--ok)}

    .icon-btn{padding:8px 10px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .icon-btn.todo{background:transparent;color:var(--accent);border:1px solid rgba(167,139,250,0.08)}
    .icon-btn.doing{background:transparent;color:var(--primary);border:1px solid rgba(34,211,238,0.08)}
    .icon-btn.done{background:transparent;color:var(--ok);border:1px solid rgba(52,211,153,0.08)}
    .icon-btn.remove{background:var(--danger);color:white}
    .empty{padding:30px;text-align:center;color:var(--sub)}

    .selected-list{display:grid;gap:10px}
    .selected-card{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}

    @media (max-width:880px){
      .auth-wrap{flex-direction:column;padding:14px}
      .toolbar{flex-direction:column;align-items:stretch}
      .course-meta h4{max-width:200px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="brand">
          <div class="logo">C+</div>
          <div>
            <div style="font-size:15px">Cursos+</div>
            <div style="font-size:12px;color:var(--sub)">organize seus cursos — demo</div>
          </div>
        </div>

        <div class="nav" id="topNav">
          <button id="nav-dashboard" class="active">Dashboard</button>
          <button id="nav-selected">Meus Cursos</button>
          <button id="nav-login" style="display:none">Entrar / Cadastrar</button>
          <button id="btn-logout" class="logout" style="display:none">Sair</button>
        </div>
      </div>

      <div class="panel" id="panel-dashboard">

        <div id="authPrompt" style="display:none" class="auth-wrap">
          <div class="auth-box">
            <div class="auth-title">Bem-vindo</div>
            <div class="muted">Faça login ou crie uma conta para salvar seus cursos localmente.</div>
            <div style="display:flex;gap:10px">
              <button class="btn primary" id="toRegisterTop">Criar conta</button>
              <button class="btn ghost" id="toLoginTop">Entrar</button>
            </div>
          </div>
        </div>

        <div id="dashboardArea" style="display:block">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:14px;flex-wrap:wrap">
            <div>
              <div style="font-weight:800;font-size:18px" id="hello">Olá!</div>
              <div class="muted" id="subtitle">Explore cursos públicos e marque seu progresso.</div>
            </div>
            <div style="display:flex;gap:10px;align-items:center">
              <div id="counters" class="small muted"></div>
              <button id="btn-refresh" class="btn ghost">Atualizar</button>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="toolbar">
            <input id="search" type="text" placeholder="Buscar por título ou provedor">
            <select id="filter-status">
              <option value="all">Todos</option>
              <option value="todo">A Fazer</option>
              <option value="doing">Em Andamento</option>
              <option value="done">Realizado</option>
            </select>
            <div style="display:flex;gap:8px">
              <input id="api-url" type="text" placeholder="URL da API (opcional)" style="min-width:220px">
              <button id="btn-fetch" class="btn primary">Carregar</button>
            </div>
          </div>

          <div class="grid">
            <div class="list" id="list"></div>
            <div class="empty" id="empty" style="display:none">Nenhum curso. Clique em "Carregar" para obter cursos.</div>
          </div>
        </div>
      </div>

      <div class="panel" id="panel-auth" style="display:none">
        <div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center">
          <div class="auth-box" id="box-login">
            <div class="auth-title">Entrar</div>
            <div class="muted">Use um email e senha (dados salvos localmente nesta demo).</div>
            <div class="field"><input id="login-email" type="email" placeholder="seu@email.com"></div>
            <div class="field"><input id="login-password" type="password" placeholder="Senha"></div>
            <div style="display:flex;gap:8px">
              <button class="btn primary" id="btn-login">Entrar</button>
              <button class="btn ghost" id="show-register">Cadastrar</button>
            </div>
            <div class="error" id="login-error"></div>
          </div>

          <div class="auth-box" id="box-register" style="display:none">
            <div class="auth-title">Criar conta</div>
            <div class="muted">Crie uma conta para salvar seus cursos.</div>
            <div class="field"><input id="reg-email" type="email" placeholder="seu@email.com"></div>
            <div class="field"><input id="reg-password" type="password" placeholder="Senha (mín 6)"></div>
            <div class="field"><input id="reg-confirm" type="password" placeholder="Confirmar senha"></div>
            <div style="display:flex;gap:8px">
              <button class="btn ok" id="btn-register">Cadastrar</button>
              <button class="btn ghost" id="show-login">Voltar</button>
            </div>
            <div class="error" id="reg-error"></div>
          </div>
        </div>
      </div>

      <div class="panel" id="panel-selected" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800;font-size:18px">Meus Cursos</div>
            <div class="muted">Cursos que você marcou (A Fazer / Em Andamento / Realizado).</div>
          </div>
          <div>
            <button id="backDashboard" class="btn ghost">Voltar ao Dashboard</button>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="selected-list" id="selectedList"></div>
        <div class="empty" id="selectedEmpty" style="display:none">Você ainda não marcou nenhum curso.</div>
      </div>
    </div>
  </div>

  <script>

    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const DEFAULT_API = 'https://api.sampleapis.com/codingresources/codingResources';

    const storage = {
      get users(){ return JSON.parse(localStorage.getItem('cplus_users')||'[]') },
      set users(v){ localStorage.setItem('cplus_users', JSON.stringify(v)) },
      get session(){ return JSON.parse(localStorage.getItem('cplus_session')||'null') },
      set session(v){ localStorage.setItem('cplus_session', JSON.stringify(v)) },
      statusKey(email){ return 'cplus_status:'+email },
      getStatuses(email){ return JSON.parse(localStorage.getItem(this.statusKey(email))||'{}') },
      setStatuses(email,map){ localStorage.setItem(this.statusKey(email), JSON.stringify(map)) }
    };

    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }


    let filteredCourses = [];

    function showPanel(name){
      $('#panel-dashboard').style.display = name==='dashboard' ? 'block' : 'none';
      $('#panel-auth').style.display = name==='auth' ? 'block' : 'none';
      $('#panel-selected').style.display = name==='selected' ? 'block' : 'none';

      $('#nav-dashboard').classList.toggle('active', name==='dashboard');
      $('#nav-selected').classList.toggle('active', name==='selected');
      $('#nav-login').style.display = storage.session ? 'none' : 'inline-block';
      $('#btn-logout').style.display = storage.session ? 'inline-block' : 'none';
   
      $('#authPrompt').style.display = storage.session ? 'none' : 'block';
    }

    $('#nav-dashboard').onclick = ()=>{ showPanel('dashboard'); renderList(); };
    $('#nav-selected').onclick = ()=>{ showPanel('selected'); renderSelected(); };
    $('#nav-login').onclick = ()=>{ showPanel('auth'); };
    $('#toRegisterTop').onclick = ()=>{ showPanel('auth'); showRegister(); };
    $('#toLoginTop').onclick = ()=>{ showPanel('auth'); showLogin(); };
    $('#backDashboard').onclick = ()=>{ showPanel('dashboard'); renderList(); };
    $('#btn-logout').onclick = ()=>{ storage.session = null; updateHello(); showPanel('dashboard'); };

    function showLogin(){ $('#box-login').style.display='block'; $('#box-register').style.display='none' }
    function showRegister(){ $('#box-login').style.display='none'; $('#box-register').style.display='block' }
    $('#show-register').onclick = showRegister;
    $('#show-login').onclick = showLogin;

    $('#btn-register').onclick = async ()=>{
      $('#reg-error').textContent = '';
      const email = $('#reg-email').value.trim().toLowerCase();
      const pass = $('#reg-password').value;
      const conf = $('#reg-confirm').value;
      if(!email || !pass){ $('#reg-error').textContent='Preencha email e senha'; return; }
      if(pass.length < 6){ $('#reg-error').textContent='Senha mínima: 6 caracteres'; return; }
      if(pass !== conf){ $('#reg-error').textContent='Senhas não coincidem'; return; }
      const users = storage.users;
      if(users.find(u=>u.email===email)){ $('#reg-error').textContent='Email já cadastrado'; return; }
      const hash = await sha256(pass);
      users.push({ email, passwordHash: hash, createdAt: Date.now() });
      storage.users = users;
      storage.session = { email };
      initAfterAuth();
      showPanel('dashboard');
    };

    $('#btn-login').onclick = async ()=>{
      $('#login-error').textContent = '';
      const email = $('#login-email').value.trim().toLowerCase();
      const pass = $('#login-password').value;
      const users = storage.users;
      const user = users.find(u=>u.email===email);
      if(!user){ $('#login-error').textContent='Usuário não encontrado'; return; }
      const hash = await sha256(pass);
      if(hash !== user.passwordHash){ $('#login-error').textContent='Senha incorreta'; return; }
      storage.session = { email };
      initAfterAuth();
      showPanel('dashboard');
    };

    function initAfterAuth(){
      updateHello();
   
      const s = storage.getStatuses(storage.session.email);
      if(!s) storage.setStatuses(storage.session.email, {});
      $('#authPrompt').style.display = 'none';
      $('#nav-login').style.display = 'none';
      $('#btn-logout').style.display = 'inline-block';
    }

    function updateHello(){
      $('#hello').textContent = storage.session ? ('Olá, ' + storage.session.email) : 'Olá!';
    }

    async function fetchCourses(url){
      const api = url && url.trim() ? url.trim() : DEFAULT_API;
      try{
        const res = await fetch(api, { cache:'no-store' });
        if(!res.ok) throw new Error('status '+res.status);
        const data = await res.json();
        const arr = Array.isArray(data) ? data : (Array.isArray(data?.results) ? data.results : []);
        if(!arr.length) throw new Error('empty');
        allCourses = arr.map(item => {
          const title = item.title || item.name || item.description || item.topic || 'Curso';
          const url = item.url || item.link || item.website || '';
          const provider = item.provider || (Array.isArray(item.topics) && item.topics[0]) || (url ? (new URL(url)).hostname.replace('www.','') : '');
          const id = (item.id !== undefined && item.id !== null) ? String(item.id) : (url || title).slice(0,120);
          return { id, title: String(title).trim(), url, provider };
        });
      }catch(err){
        console.warn('fetch failed', err);
      
        allCourses = [
          { id:'mdn-js', title:'JavaScript — Guia MDN', url:'https://developer.mozilla.org/pt-BR/docs/Web/JavaScript', provider:'MDN' },
          { id:'cs50', title:'CS50 — Harvard (Introdução)', url:'https://cs50.harvard.edu/x/', provider:'Harvard' },
          { id:'dio-git', title:'Git e GitHub — DIO', url:'https://web.dio.me/track/orange-tech', provider:'DIO' },
          { id:'alura-html', title:'HTML & CSS para Iniciantes', url:'https://www.alura.com.br', provider:'Alura' }
        ];
      }
      renderList();
    }


    function renderList(){
      const q = $('#search').value.trim().toLowerCase();
      const filter = $('#filter-status').value;
      const list = $('#list');
      const empty = $('#empty');
      const statuses = storage.session ? storage.getStatuses(storage.session.email) : {};

      filteredCourses = allCourses.filter(c => {
        const matchQ = !q || c.title.toLowerCase().includes(q) || (c.provider||'').toLowerCase().includes(q);
        const status = statuses[c.id] || 'none';
        const matchFilter = filter==='all' || status===filter;
        return matchQ && matchFilter;
      }).sort((a,b)=> a.title.localeCompare(b.title, 'pt', {sensitivity:'base'}));

      list.innerHTML = '';
      if(filteredCourses.length === 0){ empty.style.display='block'; return } else { empty.style.display='none' }

      filteredCourses.forEach(c => {
        const s = storage.session ? (storage.getStatuses(storage.session.email)[c.id] || 'none') : 'none';
        const node = document.createElement('div');
        node.className = 'course-card';
        node.innerHTML = `
          <div class="course-left">
            <div class="thumb">${escapeHtml((c.title||'').split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase())}</div>
            <div class="course-meta">
              <h4 title="${escapeHtml(c.title)}">${escapeHtml(c.title)}</h4>
              <div style="display:flex;gap:10px;align-items:center;margin-top:6px">
                <small class="muted">${escapeHtml(c.provider||'')}</small>
                ${c.url ? `<small style="opacity:.9">• <a href="${c.url}" target="_blank" rel="noopener">Abrir</a></small>` : ''}
                ${ s !== 'none' ? `<span class="pill ${s}" style="margin-left:6px">${ s==='todo' ? 'A Fazer' : s==='doing' ? 'Em Andamento' : 'Realizado' }</span>` : '' }
              </div>
            </div>
          </div>

          <div class="course-actions">
            <button class="icon-btn todo" title="Marcar A Fazer" data-id="${escapeHtml(c.id)}" data-action="todo"> A Fazer</button>
            <button class="icon-btn doing" title="Marcar Em Andamento" data-id="${escapeHtml(c.id)}" data-action="doing"> Em Andamento</button>
            <button class="icon-btn done" title="Marcar Realizado" data-id="${escapeHtml(c.id)}" data-action="done"> Realizado</button>
          </div>
        `;
        list.appendChild(node);
      });


      $$('.icon-btn').forEach(btn=>{
        btn.onclick = ()=> {
          const id = btn.dataset.id;
          const action = btn.dataset.action;
          if(!storage.session){ alert('Faça login para salvar seus cursos.'); showPanel('auth'); return }
          setStatus(id, action);
        };
      });

      updateCounters();
    }

    function updateCounters(){
      if(!storage.session){ $('#counters').textContent = ''; return }
      const s = storage.getStatuses(storage.session.email);
      const values = Object.values(s || {});
      const todo = values.filter(v=>v==='todo').length;
      const doing = values.filter(v=>v==='doing').length;
      const done = values.filter(v=>v==='done').length;
      $('#counters').textContent = `A Fazer: ${todo} • Em Andamento: ${doing} • Realizado: ${done}`;
    }


    function setStatus(id, status){
      if(!storage.session) return alert('Faça login para usar este recurso.');
      const email = storage.session.email;
      const map = storage.getStatuses(email) || {};
      map[id] = status;
      storage.setStatuses(email, map);
      renderList();
    }

    function removeStatus(id){
      if(!storage.session) return alert('Faça login para usar este recurso.');
      const email = storage.session.email;
      const map = storage.getStatuses(email) || {};
      delete map[id];
      storage.setStatuses(email, map);
      renderSelected();
      renderList();
    }


    function renderSelected(){
      const selList = $('#selectedList');
      const selEmpty = $('#selectedEmpty');
      selList.innerHTML = '';
      if(!storage.session){ selEmpty.style.display='block'; selList.innerHTML=''; return }
      const statuses = storage.getStatuses(storage.session.email) || {};
      const selectedIds = Object.keys(statuses).filter(id => statuses[id] && statuses[id] !== 'none');
      if(selectedIds.length===0){ selEmpty.style.display='block'; return } else { selEmpty.style.display='none' }


      const items = selectedIds.map(id => {
        const course = allCourses.find(c=>String(c.id)===String(id));
        return { id, title: course ? course.title : id, provider: course?course.provider:'', url: course?course.url:'' , status: statuses[id] };
      }).sort((a,b)=>a.title.localeCompare(b.title,'pt',{sensitivity:'base'}));

      items.forEach(c=>{
        const el = document.createElement('div');
        el.className = 'selected-card';
        el.innerHTML = `
          <div>
            <div style="font-weight:700">${escapeHtml(c.title)}</div>
            <div style="font-size:13px;color:var(--sub);margin-top:6px">${escapeHtml(c.provider)} ${c.url?`• <a href="${c.url}" target="_blank">Abrir</a>`:''}</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="pill ${c.status}">${ c.status==='todo' ? 'A Fazer' : c.status==='doing' ? 'Em Andamento' : 'Realizado' }</span>
            <button class="btn ghost remove" data-id="${escapeHtml(c.id)}">Remover</button>
          </div>
        `;
        selList.appendChild(el);
      });

      $$('.btn.remove').forEach(b=>{
        b.onclick = ()=> {
          const id = b.dataset.id;
          if(!confirm('Remover este curso dos seus selecionados?')) return;
          removeStatus(id);
        };
      });
    }


    updateHello();
    showPanel('dashboard');


    $('#btn-fetch').onclick = ()=> {
      const url = $('#api-url').value.trim();
      fetchCourses(url).then(()=>{ showPanel('dashboard'); });
    };
    $('#btn-refresh').onclick = ()=> fetchCourses($('#api-url').value.trim());
    $('#search').addEventListener('input', ()=> renderList());
    $('#filter-status').addEventListener('change', ()=> renderList());


    $('#toRegisterTop').addEventListener('click', ()=> { showPanel('auth'); showRegister(); });
    $('#toLoginTop').addEventListener('click', ()=> { showPanel('auth'); showLogin(); });


    (function boot(){
      if(storage.session){
        initAfterAuth();
      } else {
        $('#nav-login').style.display = 'inline-block';
      }
      fetchCourses();
    })();

    window._cplus = { fetchCourses, renderList, setStatus, removeStatus, storage };
  </script>
</body>
</html>
